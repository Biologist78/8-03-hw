# Домашнее задание к занятию "Базы данных, их типы" - Пешева Ирина


### Задание 1. СУБД

#### Кейс
Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области. 

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему? 
 
1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков.
СУБД должна гарантировать целостность и чёткую структуру данных.

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы? 

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к 
маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? 
СУБД должны быть гибкими и быстрыми.

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу 
и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это 
реализовать?

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов 
по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать
со связями.

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД 
логистов?

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

*Приведите ответ в свободной форме.*

### Решение 1

#### 1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.

Целостность обеспечивают СУБД, отвечающие критериям **ACID**, то есть прежде всего это **реляционные СУБД**.

Так как, похоже, не так важна отказоустойчивость, как важна согласованность, больше подходят те СУБД, которые ближе всего к типу **PC/EC** — в случае чего лучше аналитики подождут, а не будут ориентироваться на неправильные данные.

#### 1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы? 

Предположим, что хеширование у нас происходит при создании индексов в базе данных. Вообще говоря, такой способ индексации упоминается как достаточно быстрый, и вызывает проблемы только при, например, вызове диапазанов или поиске частичных совпадений, а собственно при хешировании возникает только необходимость избежать коллизии, что действительно занимает время.

Кажется, к таким проблемам вынос обращения к БД через API не сильно применим. В таких случаях рекомендуют либо изменить сам способ индексирования, либо обновить железо (что, впрочем, универсальный совет, на уровне "перезагрузите систему").

Если же имеется в виду хеширование как способ шифрования на стороне базы данных, то всё зависит от API, который используется на данный момент. Как будто подойдёт любая достаточно быстрая библиотека для хеширования, которую можно использовать на стороне промежуточного API, после чего зашифрованные данные будут уже в таком виде записываться в БД. 

#### 1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

Исходя из требований к скорости, мы приходим к пренебрежению моделью **ACID** и к свойствам **PA/EL**; в этом плане идеальны NoSQL СУБД.

Хранение лендинга как будто не налагет серьёзных ограничений на БД, так как на этих ваших форумах в любом случае рекомендуют хранить только ссылки на нужные файлы. 

Данные, передаваемые в CRM, могут храниться в какой-нибудь **документо-ориентированной** СУБД ровно в том виде, который требует API CRM. К тому же добавление новых данных в таких СУБД будет происходить быстро и без необходимости создания новых структур.

#### 1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

Если говорить о конкретной реализации то, кажется, каким-то из подобранных критериев придётся пожертвовать. 

В любом случае, предполагается **NoSQL** БД, однако найти **документо-оринетированную** БД, удовлетворяющую условиям **PA/EL** (да ещё такую, чтобы по ней было достаточно много информации для оценки пригодности), оказалось задачей нетривиальной. MongoDB в общем случае больше подходит под требования гибкости, но та же Cassandra в сравнениях указывается как более быстрая, хоть и предполагающая чуть больше структурированности (и не являющаяся документо-ориентированной к тому же, данные хранятся в таблицах, хоть и весьма многомерных). Но, так как Cassandra изначально предполагает работу с большими массивами данных, а мы вроде бы не рассчитываем на такую нагрузку, нет смысла в такой серьёзной системе.

#### 1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

Понимание простой и понятной структуры может быть разным у разных людей, так что для начала хорошо бы хорошенько потрясти заказчика. Насколько для него проста структура реляционных баз данных? Вы поймёте иерархическую структуру? Или вам оставить наипростейшую БД-словарь с форматом ключ-значение (структура вам будет проста и понятна, а вот сможете ли вы что-либо найти — другой вопрос).

Но если отпустить заказчика с богом, то можно попробовать использовать **иерархическую** СУБД. Она хорошо сможет отразить структуру компании с её отделами и пододелами и дальнейшим ветвлением по различного типа документам.

Правда, в сети о таких СУБД не так много информации (не так много, как о реляционных и популярных NoSQL), и ещё они названы громоздкими и непонятными пользователям. (*Но я бы всё равно не поверила на слово и попробовала.*)

*(А ещё ради интереса можно попробовать **объектно-ориентированную** БД, так как подотделы наверняка могут наследовать часть нормативов и документов от родительского отдела с добавлением своих собственных; а какие-то документы вообще будут едины для всей организации.)*

#### 1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

В задаче 1.1 была выбрана реляционная база данных с высокой степенью согласованности. Безусловно, можно использовать такого рода СУБД, разделить на отдельные сущности знания об отделах, об их подотделах, о документах, их типах и принадлежности к отделам, а затем связями сводить это всё в единую таблицу. Возможно, так будет даже нагляднее.

Также это можно хранить и в выбранной в 1.2 NoSQL базе данных, описывая это вложением одних струкрур в другие, что также обеспечит большую гибкость и всё ещё будет отображать иерархичность данных.

#### 1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

Исторически задачи поиска кратчайшего пути решаются графами, так что **графовые** СУБД отлично подойдут для решения задачи. В них будут храниться данные и в них уже есть механизмы работы с графами. Оптимизационные задачи, вроде распределения курьеров, тоже в некоторых случаях решаются графовыми алгоритмами, так что такой тип должен покрывать потребности логистики.

#### 1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

Зависит от требований отдела закупок. Опять же, какие-то расчёты удобно проводить на графах.

Однако сделаем предположение, что это вряд ли интересует закупки, и им интереснее хранить данные без каких-то серьёзных вычислений. Для них графовая структура слабо применима, и нужно искать другое решение.

#### 1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

Кажется, любую задачу можно решить любым инструментом (вопрос целесообразности), а вот по критериям целостности, гибкости и скорости подойдут далеко не все.

Предположим, что проще обеспечить скорость у делающей упор на целостность данных СУБД, чем наоборот. В таком случае мы приходим к использованию **реляционных** СУБД, в которых можно настроить нужную структуру, правильно создать связи, добавить механизмы кеширования и индексирования для ускорения работы, чтобы закрыть все потребности. Кроме гибкости, возможно.

Либо использовать какие-либо **NoSQL** СУБД, вроде той же Cassandra, в которой так или иначе обеспечивается целостность (хоть и только при отсутствии распада), где будет не так удобно поддерживать связность между данными, но она будет быстрее и более гибкой.

---
### Задание 2. Транзакции

2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы 
транзакция завершилась успешно. Ориентируйтесь на шесть действий.

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

*Приведите ответ в свободной форме.*

### Решение 2

1. Открыть транзакцию, заблокировав действия со счётом отправителя (либо каким-либо другим сопособом обеспечив требования изоляции).
1. Проверить счёт отправителя (хватает ли суммы, не заблокирован ли он, существует ли он вообще) и одобрить, если возможно.
1. Проверить номер телефона (существует, доступен для пополнения) и одобрить, если возможно.
1. Вычесть отправляемую сумму.
1. Зачислить сумму на баланс телефонного номера.
1. Отправить подтверждение об успешном проведении транзакции и закрыть её, разблокировав действия со счётом отправителя.

#### 2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

0. В зависимости от типа автоплатежа:
    1. По некоторому расписанию проверяются автоплатежи и определяются номера, для которых нужно провести списание; открываются транзакции для найденных номеров.
    1. Происходит списание средств с номера абонента:
        1. Проверяется, ушёл ли баланс ниже указанной в условиях автоплатежа черты.
        2. Если да, то инициируется транзакция.

Далее шаги повторяют описанные ранее.

---
### Задание 3. SQL vs NoSQL

3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

*Приведите ответ в свободной форме.*

### Решение 3

1. Обеспечивается поддержка требований ACID: реляционная структура позволяет следовать требованиям целостности и предотвращать их нарушение.
1. Проще анализировать данные, так как понятно что где лежит, видны связи, данные (в идеале) не дублируются.
1. В ряде СУБД реализована поддержка некоторых структур, характерных для NoSQL СУБД. Например, данные также могут храниться в формате JSON, как и в документо-ориентированных СУБД.
1. Большое распространение. Больше документации, больше комьюнити — проще найти решение проблемы.
1. История SQL-систем больше. Соответственно, они лучше изучены, больше проблем было решено, меньше багов возникает, разработаны механизмы оптимизации. Они в этом плане "совершеннее".

#### 3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

NewSQL как гибрид стремится взять всё самое хорошее, а самое плохое не брать:

* оставлена реляционная природу схем, обеспечена целостность, тем самым преодолев недостатки NoSQL;
* и при этом реализована ещё и возможность работать на нескольких узлах (что решает извечную, судя по статьям, проблему SQL с масштабированием и распределением).

К тому же некоторые NewSQL, похоже, решили разрабатывать с нуля, поэтому они более "гибкие" в сфере изменений, чем некоторые более громоздкие за счёт накопившегося кода SQL-системы. К тому же как более молодые системы они используют технологии, которые не были доступны во времена зарождения SQL-систем.


---
### Задание 4. Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу 
выделено 1000 машин. 

На основе какого критерия будете выбирать тип СУБД и какая модель *распределённых вычислений* 
здесь справится лучше всего и почему?

*Приведите ответ в свободной форме.*

### Решение 4

#### Тип СУБД

Как было сказано ранее, NoSQL и NewSQL системы появились как раз для решения проблем с распределённой работой. К тому же именно NoSQL системы рекомендуют для работы с большим количеством данных.

В идеале нужно иметь представление, что же это за данные и нужна ли между ними хоть какая-то связность. Но любом случае, в связи с большими данными рекомендуется и упоминается Cassandra. Для неё же заявляется высокая устойчивость к выходу из строя узлов и простота их добавления.

Из NewSQL также упоминается CockroachDB, масштабируемая и отказоустойчивая аки таракан. Ещё и совместима с PostgreSQL, и язык у неё SQL. И обеспечивает консистентность. Но скорость обработки данных в достоинствах не мелькает, поэтому могуть быть проблемы, требуется более тщательное изучение.

#### Модель распределённых вычислений

В качестве модели распределённых вычислений можно использовать MapReduce. 

Во-первых, это практически всё, что можно получить при поиске по запросу "модели распределённых вычислений". Что говорит о распространённости и эффективности модели. К тому же, есть огромное количество материалов для общего понимания сути модели, примеров использования, реализаций и руководств.

Во-вторых, по описанию это и правда идеальная модель (или технология, или алгоритм; в комментариях все всех поправляют по этому поводу), подходящая под обработку огромных, измеряемых в петабайтах, данных, и разработанная для распределенных кластеров.

Также можно найти модели на основе графовых вычислений (например, Dryad, но он как-будто пропал из всех статей после 2013 года), а также потоковая обработка данных (вроде той, что используется в Apache Spark), но для поставленной задачи MapReduce всё ещё выглядит как оптимальное решение.