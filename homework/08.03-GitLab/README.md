# Домашнее задание к занятию "GitLab" - Пешева Ирина


### Задание 1
**Что нужно сделать:**

1. Разверните GitLab локально, используя Vagrantfile и инструкцию, описанные в [этом репозитории](https://github.com/netology-code/sdvps-materials/tree/main/gitlab).   
2. Создайте новый проект и пустой репозиторий в нём.
3. Зарегистрируйте gitlab-runner для этого проекта и запустите его в режиме Docker. Раннер можно регистрировать и запускать на той же виртуальной машине, на которой запущен GitLab.

В качестве ответа в репозиторий шаблона с решением добавьте скриншоты с настройками раннера в проекте.
### Решение 1

Gitlab развёрнут, проект и репозиторий созданы:

![Alt text](img/1.png)

На той же виртуальной машине запущен контейнер с раннером. Конфигурация:

![Alt text](img/2.png)

Контейнер:

![Alt text](img/3.png)

Теперь он используется в качестве раннера проекта:

![Alt text](img/4.png)


---
### Задание 2
**Что нужно сделать:**

1. Запушьте [репозиторий](https://github.com/netology-code/sdvps-materials/tree/main/gitlab) на GitLab, изменив origin. Это изучалось на занятии по Git.
2. Создайте .gitlab-ci.yml, описав в нём все необходимые, на ваш взгляд, этапы.

В качестве ответа в шаблон с решением добавьте: 
   
 * файл gitlab-ci.yml для своего проекта или вставьте код в соответствующее поле в шаблоне; 
 * скриншоты с успешно собранными сборками.
### Решение 2

Репозиторий был успешно добавлен в проект:

![Alt text](img/5.png)

Добавлен gitlab-ci.yml. В качестве этапов были установлены тестирование и сборка:

```yaml
stages:
  - test
  - build

test:
  stage: test
  script: 
   - go test .

build:
  stage: build
  image: docker:latest
  script:
   - docker build -t someapp .
```

Pipeline был успешно пройден:

![Alt text](img/6.png)

---

## Дополнительные задания (со звездочкой*)

Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

### Задание 3
Измените CI так, чтобы:

 - этап сборки запускался сразу, не дожидаясь результатов тестов;
 - тесты запускались только при изменении файлов с расширением *.go.

В качестве ответа добавьте в шаблон с решением файл gitlab-ci.yml своего проекта или вставьте код в соответсвующее поле в шаблоне.
### Решение 3

#### Параллельный запуск

В качестве самого очевидного решения для параллелизации был добавлен второй раннер, а jobs для тестирования и сборки вынесены на один этап.

```yaml
stages:
  - build

test:
  stage: build
  script: 
   - go test .

build:
  stage: build
  image: docker:latest
  script:
   - docker build -t someapp .
```

Job'ы выполняются вместе:

![Alt text](img/7.png)

#### Условный запуск

Для обработки условий был добавлен ключ "only" с указанием "только при изменении файлов *.go":

```yaml
stages:
  - build

build:
  stage: build
  image: docker:latest
  script:
   - docker build -t someapp .

test:
  stage: build
  script: 
   - go test .
  only:
    changes:
      - "*.go"
```

Уже при добавлении gitlab-ci.yml не запускался job-test:

![Alt text](img/8.png)

Но запустился при изменении файла main-test.go:

![Alt text](img/9.png)